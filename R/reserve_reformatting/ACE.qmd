---
title: "ACE"
format: html
---

```{r}
library(tidyverse)
library(readxl)
reserve <- "ACE"
```


```{r}
path_start <- here::here("submitted_data", "data", reserve)
problem_path_out <- here::here("wrangled_data", "combined_with_issues")
path_out <- here::here("wrangled_data", "CDMO")

# create the output folder if it doesn't already exist
if(!dir.exists(path_out)){
    dir.create(path_out)
}
```

## Cover  

```{r}
# dir(path_start)
# excel_sheets(here::here(path_start, "ACE Basin biomonitoring data_11Aug2021.xlsx"))
pi_cov <- read_xlsx(here::here(path_start, 
                               "ACE Basin biomonitoring data_11Aug2021_smu.xlsx"),
                    sheet = "PerCov_raw")

cov_summ <- pi_cov %>% 
    group_by(Date, PlotID) %>% 
    summarize(across(c(Sediment:Mussel, Bare),
              function(x) sum(x)*2)
    ) %>% 
    select(Date, PlotID, SpaAlt, SalVir, JunRoe, Bare, everything())
```

## Height  

```{r}
hts <- read_xlsx(here::here(path_start, 
                               "ACE Basin biomonitoring data_11Aug2021_smu.xlsx"),
                    sheet = "SpHt_raw")

# ignoring SubQuad to make a new plant num column, then pivot wider
hts_wide <- hts %>% 
    group_by(Date, PlotID) %>% 
    mutate(PlantNum2 = 1:n()) %>%  
    rename(SpaAlt = "SpaAlt(cm)") %>% 
    select(Date, PlotID, PlantNum2, SpaAlt) %>% 
    pivot_wider(names_from = PlantNum2,
                names_prefix = "Spartina alterniflora_",
                values_from = SpaAlt)
```

## for data request  

### Plots  

Assigning site names based on different locations in metadata - transects 1-3 are more southern, 4-6 are more northern.  

"The biomonitoring study area, a component of the ACE Sentinel Site, is located at Edisto Island State Park, Edisto Island, SC (see map below). The study area is in the salt marshes along Big Bay Creek. Transects 1 thru 3 are in a marsh that is mainly characterized by smooth cordgrass (Spartina alterniflora) and glasswort (Salicornia virginica); while transects 4 thru 6 are in a marsh that is dominated by smooth cordgrass (Spartina alterniflora), with black needlerush (Juncus roemerianus) near the marsh-upland border."

```{r}
sites_etc <- pi_cov %>% 
    select(PlotID) %>% 
    filter(!is.na(PlotID)) %>% 
    distinct() %>% 
    separate(PlotID, into = c("TransectID", "PlotID"),
             remove = TRUE) %>% 
    mutate(SiteID = case_when(TransectID %in% c("T1", "T2", "T3") ~ "EI South",
                              TRUE ~ "EI North")) %>% 
    select(SiteID, TransectID, PlotID) %>% 
    arrange(TransectID, SiteID, PlotID)

write.csv(sites_etc, here::here("wrangled_data",
                                "combined_with_issues",
                                "ACE_plots.csv"))
```

